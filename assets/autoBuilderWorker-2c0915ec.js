(function(){"use strict";importScripts("https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js");let t=null,i=null,s=null,d=null,n=null,a=null;const c=async()=>{i=await loadPyodide(),await i.loadPackage("micropip");const e=i.pyimport("micropip");console.log("Installing msgspec"),await e.install("https://cdn.jsdelivr.net/gh/mikeshardmind/wakfu-utils@d4d24e1f631b5cf99ee1d9a7ee18bb8bd954fe9c/msgspec-0.18.4-cp311-cp311-emscripten_3_1_45_wasm32.whl"),console.log("Setting up the AutoBuild package loaded."),await e.install("wakautosolver"),console.log("AutoBuild package installed."),s=i.pyimport("wakautosolver.versioned_entrypoints"),console.log("AutoBuild package loaded."),postMessage("workerReady")},g=async()=>{var e;await u(d),t!=null&&t.error_code||((e=t==null?void 0:t.item_ids)==null?void 0:e.length)===0?(console.log("An error occured",t.error_code),postMessage({items:null,error:t.error_code,debugInfo:t.debug_info})):y()},u=async e=>{console.log("Python Params (useful for debugging if you need them)",e);let l=s.SetMinimums.callKwargs(e.targetStatParams),o=s.StatPriority.callKwargs({distance_mastery:e.distanceMastery?1:0,melee_mastery:e.meleeMastery?1:0,heal_mastery:e.healingMastery?1:0,rear_mastery:e.rearMastery?1:0,berserk_mastery:e.berserkMastery?1:0,elements:e.elementPriorities}),r=s.v2Config.callKwargs({allowed_rarities:e.selectedRarityIds!==void 0?e.selectedRarityIds:[0,1,2,3,4,5,6,7],target_stats:l,dry_run:!1,objectives:o,forbidden_items:e.excludedItems,forbidden_sources:e.forbiddenSources,ignore_existing_items:e.ignoreEquippedItems||!1});console.log(e.excludedItems);let m={build_code:e.buildCode,config:r};console.log("Calling the Python solver method now.");let _=s.partial_solve_v2.callKwargs(m);console.log("Assigning results."),t=_},y=()=>{console.log("Collecting the item data for the FE display.");let e=t.item_ids,l=[];n.forEach(o=>{e.includes(o.id)&&l.push(o)}),l.sort((o,r)=>a.indexOf(o.type.validSlots[0])-a.indexOf(r.type.validSlots[0])),console.log("Item data is",l),postMessage({items:l,error:null})};c(),onmessage=async e=>{d=e.data.params,n=e.data.itemData,a=e.data.ITEM_SLOT_SORT_ORDER,g()}})();
